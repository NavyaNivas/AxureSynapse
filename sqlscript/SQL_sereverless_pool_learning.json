{
	"name": "SQL_sereverless_pool_learning",
	"properties": {
		"content": {
			"query": "--select query to preview the data in external files..\n--for csv files parserversion and header row is mandatory to read the schema..\n\n\nselect top 10* from OPENROWSET(\n    BULK  'abfss://input@synapsestorage1505.dfs.core.windows.net/employee_data.csv',\n    FORMAT = 'csv',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n)as [result]\n  \n\n\n\nselect * from OPENROWSET(\n    BULK  'abfss://input@synapsestorage1505.dfs.core.windows.net/salary_data.parquet',\n    FORMAT = 'parquet'\n\n)as [result]\n\n--we can craete external tables only in serverless pool as there is no storage location involved with it..\n--create external table in  serverless pool..\n\nCREATE DATABASE myExternalDb\n\nUSE  myExternalDb\n\nCREATE MASTER KEY ENCRYPTION BY PASSWORD = 'Password@123'\nGO\n\n--using SAS token--\n\nCREATE DATABASE SCOPED CREDENTIAL myCredential \nWITH\nidentity = 'shared access signature',\nSECRET = 'sv=2024-11-04&ss=bfqt&srt=sco&sp=rwdlacupyx&se=2025-11-17T15:56:53Z&st=2025-11-17T07:41:53Z&spr=https&sig=Q5IcJLoKjwx%2FtRcQaOHvST54LXc0EFdQ3MbMFAzGVkk%3D'\nGO\n\n--using manged identity\n\nCREATE DATABASE SCOPED CREDENTIAL MyManagedIdentity\nWITH IDENTITY = 'Managed Identity'\nGO\n\n--can create data source with any one one of the credential..\n--location should be primary storage end point at the storage account level\n\nCREATE EXTERNAL DATA SOURCE externalDataSource \nWITH(\n    LOCATION = 'https://synapsestorage1505.blob.core.windows.net/',\n    CREDENTIAL = myCredential\n)\nGO\n\nCREATE EXTERNAL FILE FORMAT myExternalFileFormat\nWITH\n(\n    FORMAT_TYPE = PARQUET,\n    DATA_COMPRESSION = 'org.apache.hadoop.io.compress.SnappyCodec'\n\n)GO\n\nCREATE EXTERNAL TABLE extTab1 WITH(\n\n    LOCATION = '/synapsecontainer/Externaldata', --no need to mention fiull path as it is altreday linked to primary storage account..\n    DATA_SOURCE = externalDataSource,\n    FILE_FORMAT = myExternalFileFormat\n\n)AS\nSELECT * from OPENROWSET(\n    BULK  'abfss://input@synapsestorage1505.dfs.core.windows.net/salary_data.parquet',\n    FORMAT = 'parquet'\n)AS [result]\nGO\n\nselect * from extTab1\n\n--similarly we can aslo create datasource and external file systema nd external table using managed identity..\n\nCREATE EXTERNAL DATA SOURCE externalDataSource1 \nWITH(\n    LOCATION = 'https://synapsestorage1505.blob.core.windows.net/',\n    CREDENTIAL = MyManagedIdentity\n)\nGO\n\n--compression type is not needed..\n\nCREATE EXTERNAL FILE FORMAT myExternalFileFormatCSV\nWITH\n(\n    FORMAT_TYPE = DELIMITEDTEXT,\n    FORMAT_OPTIONS (FIELD_TERMINATOR = ',', STRING_DELIMITER = '\"')\n  \n)\nGO\n\n\nCREATE EXTERNAL TABLE extTab2 WITH(\n\n    LOCATION = '/synapsecontainer/Externaltable2', --no need to mention fiull path as it is altreday linked to primary storage account..\n    DATA_SOURCE = externalDataSource1,\n    FILE_FORMAT = myExternalFileFormatCSV\n\n)AS\nSELECT * from OPENROWSET(\n    BULK  'abfss://input@synapsestorage1505.dfs.core.windows.net/employee_data.csv',\n    FORMAT = 'csv',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n)AS [result]\nGO\n\nselect TOP 10* from extTab2 \n\n SELECT top 10* from extTab1\n\nselect e.empID ,e.name,e.gender,e.salary,e.department, d.deptId \nFROM  extTab1 e JOIN extTab2 d on e.empID = d.empID  order by e.department\n\n\n-- to get schema of the table..\nSELECT COLUMN_NAME, DATA_TYPE\nFROM INFORMATION_SCHEMA.COLUMNS\nWHERE TABLE_NAME = 'extTab1';\n\nselect department,SUM(salary) dept_salary from extTab1 GROUP BY department ORDER by sum(salary)\n\n\n\n\n\n\n\n\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "myExternalDb",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}